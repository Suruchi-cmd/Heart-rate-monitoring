import json
import random
import time
from datetime import datetime
import serial
import pandas as pd

from flask import Flask, Response, render_template, request, redirect

# Initialize the random number generator


application = Flask(__name__)

datapoints = [1835, 1952, 1883, 1859, 1838, 1850, 1824, 1838, 1853, 1858, 1874, 1896, 1913, 1935, 1936, 1948, 1957, 1954, 1971, 1970, 1962, 1960, 1966, 1960, 1970, 1972, 1972, 1967, 1979, 1979, 1970, 1964, 1960, 1970, 1967, 1974, 1978, 1982, 1984, 1992, 1987, 1987, 1992, 1992, 2004, 2005, 2005, 2012, 2016, 2005, 2019, 2014, 2013, 2024, 2027, 2010, 2028, 2051, 2054, 2047, 2049, 2013, 1998,
 1992, 1979, 1980, 1974, 1981, 1987, 2083, 2183, 2423, 2559, 2368, 2004, 1858, 1831, 1845, 1860, 1891, 1894, 1917, 1925, 1952, 1951, 1962, 1979, 1978, 1991, 1999, 1998, 1999, 2038, 2017, 2031, 2044, 2062, 2056, 2080, 2077, 2087, 2091, 2114, 2128, 2108, 2096, 2074, 2059, 2050, 2009, 1981, 1932, 1893, 1894, 1890, 1868, 1887, 1888, 1902, 1906, 1914, 1918, 1937, 1955, 1984, 1972,
  1982, 1974, 1986, 1986, 1955, 1972, 1969, 1998, 1994, 1987, 1983, 1991, 2004, 2009, 1991, 1991, 1988, 1979, 1983, 1986, 1993, 1994, 1989, 1986, 1986, 1995, 2000, 1995, 1997, 1990, 1982, 2003, 1993, 2008, 2004, 2012, 2013, 2010, 2015, 2016, 2014, 1998, 2007, 1956, 1886, 1876, 1844, 1823, 1817, 1835, 1853, 1862, 1872, 1883, 1911, 1906, 1934, 1944, 1939, 1954, 1971, 1960, 1976,
  1978, 1957, 1966, 1968, 1956, 1959, 1978, 1966, 1968, 1977, 1975, 1968, 1971, 1975, 1960, 1983, 1974, 1974, 1984, 1987, 1992, 1996, 1994, 2001, 1998, 2022, 2007, 2008, 2024, 2011, 2015, 1999, 1999, 1996, 2011, 2023, 2045, 2059, 2056, 2066, 2041, 2020, 1990, 1980, 1985, 1992, 1987, 1983, 2040, 2130, 2325, 2527, 2523, 2096, 1901, 1838, 1853, 1851, 1872, 1893, 1919, 1930, 1943,
  1954, 1960, 1978, 1973, 1984, 1983, 1992, 2006, 2016, 2006, 2027, 2051, 2070, 2055, 2070, 2078, 2074, 2102, 2102, 2116, 2108, 2102, 2081, 2082, 2058, 2027, 1991, 1949, 1918, 1885, 1882, 1865, 1876, 1884, 1895, 1898, 1911, 1922, 1936, 1944, 1947, 1950, 1958, 1971, 1967, 1979, 1966, 1976, 1968, 1967, 1976, 1982, 1996, 1974, 1984, 1982, 1995, 2000, 1999, 1999, 2006, 1995, 2010,
  2000, 2012, 1993, 1999, 1995, 1993, 1997, 1998, 1998, 1996, 1995, 1996, 1989, 2006, 2000, 2007, 2004, 2011, 2015, 2005, 2008, 2009, 1835, 1952, 1883, 1859, 1838, 1850, 1824, 1838, 1853, 1858, 1874, 1896, 1913, 1935, 1936, 1948, 1957, 1954, 1971, 1970, 1962, 1960, 1966, 1960, 1970, 1972, 1972, 1967, 1979, 1979, 1970, 1964, 1960, 1970, 1967, 1974, 1978, 1982, 1984, 1992, 1987,
  1987, 1992, 1992, 2004, 2005, 2005, 2012, 2016, 2005, 2019, 2014, 2013, 2024, 2027, 2010, 2028, 2051, 2054, 2047, 2049, 2013, 1998, 1992, 1979, 1980, 1974, 1981, 1987, 2083, 2183, 2423, 2559, 2368, 2004, 1858, 1831, 1845, 1860, 1891, 1894, 1917, 1925, 1952, 1951, 1962, 1979, 1978, 1991, 1999, 1998, 1999, 2038, 2017, 2031, 2044, 2062, 2056, 2080, 2077, 2087, 2091, 2114, 2128,
  2108, 2096, 2074, 2059, 2050, 2009, 1981, 1932, 1893, 1894, 1890, 1868, 1887, 1888, 1902, 1906, 1914, 1918, 1937, 1955, 1984, 1972, 1982, 1974, 1986, 1986, 1955, 1972, 1969, 1998, 1994, 1987, 1983, 1991, 2004, 2009, 1991, 1991, 1988, 1979, 1983, 1986, 1993, 1994, 1989, 1986, 1986, 1995, 2000, 1995, 1997, 1990, 1982, 2003, 1993, 2008, 2004, 2012, 2013, 2010, 2015, 2016, 2014,1835, 1952, 1883, 1859, 1838, 1850, 1824, 1838, 1853, 1858, 1874, 1896, 1913, 1935, 1936, 1948, 1957, 1954, 1971, 1970, 1962, 1960, 1966, 1960, 1970, 1972, 1972, 1967, 1979, 1979, 1970, 1964, 1960, 1970, 1967, 1974, 1978, 1982, 1984, 1992, 1987, 1987, 1992, 1992, 2004, 2005, 2005, 2012, 2016, 2005, 2019, 2014, 2013, 2024, 2027, 2010, 2028, 2051, 2054, 2047, 2049, 2013, 1998,
  1992, 1979, 1980, 1974, 1981, 1987, 2083, 2183, 2423, 2559, 2368, 2004,];

@application.route('/')
def index():
    return render_template('index.html')


@application.route('/index.html')
def appli():
    return redirect('/')


@application.route('/viusal.html',methods=['POST'])
def viusal():
    if request.method=='POST':
        name=request.form['name']
        age=request.form['age']
        gender=request.form['gender']
        email=request.form['email']
        return render_template('viusal.html', name=name,age=age,gender=gender,email=email)


@application.route('/chart-data')
def chart_data():
    def generate_random_data():
        while True:

            json_data = json.dumps(
                {'time': datetime.now().strftime('%Y-%m-%d %H:%M:%S'), 'value':datapoints.pop()})
            yield f"data:{json_data}\n\n"
            time.sleep(0.5)

    return Response(generate_random_data(), mimetype='text/event-stream')


if __name__ == '__main__':
    application.run(debug=True, threaded=True)







